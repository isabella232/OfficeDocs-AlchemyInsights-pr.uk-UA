---
title: Проблеми з автентифікацією
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/25/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7748"
- "9004339"
ms.openlocfilehash: 2f413e863e6aa23548e425de5901f8158e1d48ab
ms.sourcegitcommit: ba3118b7ad5e02756d0e5c2113245090f54370af
ms.translationtype: HT
ms.contentlocale: uk-UA
ms.lasthandoff: 01/25/2021
ms.locfileid: "49976870"
---
# <a name="authentication-issues"></a>Проблеми з автентифікацією

**Шукаєте відомості про коди помилок AADSTS, які повертає служба маркерів безпеки (STS) Azure Active Directory (Azure AD)?** Перегляньте [коди помилок автентифікації та авторизації Azure AD](https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes), щоб знайти описи, виправлення та пропоновані способи вирішення помилок AADSTS.

Помилки авторизації можуть бути результатом кількох різних проблем, більшість з яких призводять до помилки 401 або 403. Наприклад, наступні проблеми можуть призвести до помилок авторизації.

- Неправильні [потоки отримання маркерів доступу](https://docs.microsoft.com/azure/active-directory/develop/authentication-vs-authorization) 
- Неналежне налаштування [областей дозволів](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent) 
- Відсутність [дозволу](https://docs.microsoft.com/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant#understanding-user-and-admin-consent)

Щоб усунути поширені помилки авторизації, спробуйте виконати ті з наведених нижче кроків, які найбільше відповідають отриманій помилці. Щоб усунути помилку, яку ви отримуєте, може знадобитися виконати кілька кроків.

**401 Не авторизовано: ваш маркер дійсний?**

Переконайтеся, що в якості частини запиту програма представляє дійсний маркер доступу до Microsoft Graph. Ця помилка часто означає, що в заголовку запиту автентифікації може бути відсутній маркер доступу, або ж він неприпустимий чи прострочений. Ми наполегливо радимо отримувати маркери доступу в бібліотеці автентифікації Microsoft (MSAL). Крім того, ця помилка може виникнути, якщо ви намагаєтеся використати маркер делегування доступу для особистого облікового запису Microsoft, щоб отримати доступ до API, який підтримує лише робочі або навчальні облікові записи (облікові записи організації).

**403 Заборонено: ви вибрали вірний набір дозволів?**

Переконайтеся, що ви запитали правильний набір дозволів на основі API Microsoft Graph, які запитує ваша програма. Рекомендовані найменш привілейовані дозволи надані в усіх розділах еталонних методів API Microsoft Graph. Крім того, ці дозволи користувач або адміністратор повинен надати програмі. Дозволи зазвичай надаються на сторінці згоди або з використанням елемента реєстрації програми Azure Portal. Виберіть у програмі меню **Параметри**, клацніть **Необхідні дозволи** та виберіть пункт **Надати дозволи**. Докладні відомості:

- [Дозволи Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference) 
- [Загальні відомості про дозволи і згоди в Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)

**403 Заборонено: програма одержала маркер, який відповідає вибраним дозволам?**

Переконайтеся, що типи запитаних або наданих дозволів відповідають типу маркера доступу, який отримала програма. Ви можете запитувати й надавати дозволи програми, але використовувати маркери потоку делегованого інтерактивного коду замість маркерів потоку облікових даних клієнта або запитувати й надавати делеговані дозволи, але використовувати маркери потоку облікових даних клієнта замість маркерів потоку делегованого коду.

Додаткові відомості про отримання маркерів:

- [Отримання доступу від імені користувачів і через делеговані дозволи](https://docs.microsoft.com/graph/auth-v2-user) 
- [Azure AD v2.0 – потік коду авторизації OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) 
- [Отримання доступу без дозволів користувача (служби daemon) і програми](https://docs.microsoft.com/graph/auth-v2-service) 
- [Azure AD v2.0 – потік облікових даних клієнта OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**403 Заборонено: скидання пароля**

Наразі між службами немає дозволів елемента daemon програми, які дозволяють скидати паролі користувачів. Ці API підтримуються лише потоками інтерактивного делегованого коду, коли адміністратор увійшов. Докладні відомості див. на сторінці [Дозволи Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference).

**403 Заборонено: чи має користувач доступ і ліцензію?**

Для потоків коду делегування Microsoft Graph оцінює дозволи, які має користувач, що увійшов, а також чи запит дозволений на основі дозволів, наданих програмі. Зазвичай ця помилка вказує на те, що користувач має недостатньо прав, щоб виконати запит, **або** не має ліцензії на отримання даних, до яких намагається отримати доступ. Успішно виконати запит можуть лише користувачі з необхідними дозволами або ліцензіями.

**403 Заборонено: ви вибрали правильний API ресурсу?**

Такі служби API, як Microsoft Graph, перевіряють, чи значення *aud* (аудиторія) в отриманому маркері доступу збігається з очікуваним значенням. Якщо це не так, виникає помилка 403 Заборонено. Поширена помилка, що призводить до цього, полягає у спробі використати маркер, отриманий для API Azure AD Graph, API Outlook або API SharePoint/OneDrive для виклику Microsoft Graph (або навпаки). Переконайтеся, що ресурс (або область), для якого ваша програма отримала маркер, збігається із API, який програма викликає.

**400 Помилковий запит або 403 Заборонено: чи дотримується користувач політики умовного доступу своєї організації?**

На основі політик умовного доступу організації користувачеві, який має доступ до ресурсів Microsoft Graph через вашу програму, може знадобитися надати додаткові відомості, яких немає в маркері доступу, котрий ваша програма одержала спочатку. У такому разі під час одержання маркера доступу ваша програма отримує помилку **400 з твердженням *interaction_required*** або **403 з твердженням *insufficient_claims*** під час виклику Microsoft Graph. В обох випадках відповідь про помилку містить додаткову інформацію, яку можна надати санкціонованій кінцевій точці, щоб отримати від користувача додаткові відомості (наприклад, багатофакторну автентифікацію або реєстрацію пристрою).

Докладні відомості про умовний доступ:

- [Обробка проблем з умовним доступом за допомогою MSAL](https://docs.microsoft.com/azure/active-directory/develop/msal-error-handling-dotnet#conditional-access-and-claims-challenges) 
- [Рекомендації для розробників щодо умовного доступу в Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/v2-conditional-access-dev-guide)

**_Завершення підтримки бібліотеки автентифікації Azure Active Directory (ADAL) і API Azure AD Graph (AAD Graph)_* _

- З 30 червня 2020 року ми не додаватимемо нові функції до бібліотеки автентифікації Azure Active Directory (ADAL) і API Azure AD Graph (AAD Graph). Ми й надалі надаватимемо технічну підтримку та оновлення системи безпеки, але більше не надаватимемо оновлення функцій.
- З 30 червня 2022 року ми припинимо підтримку ADAL і AAD Graph і більше не надаватимемо технічну підтримку чи оновлення системи безпеки.
    - Програми, які використовують ADAL у наявних версіях ОС, продовжуватимуть працювати, але не отримуватимуть технічної підтримки чи оновлень системи безпеки.
    - Програми, які продовжать використовувати AAD Graph після вказаної дати, можуть більше не отримувати відповіді від кінцевої точки AAD Graph.

_ *Перенесення ADAL**

Ми радимо оновити [бібліотеку автентифікації Microsoft (MSAL)](https://docs.microsoft.com/azure/active-directory/develop/v2-overview), яка містить найновіші функції та оновлення системи безпеки. Ця рекомендація пов’язана з тим, що програми Microsoft переносяться до MSAL до кінцевого терміну підтримки. Програми Microsoft переносяться до MSAL, щоб вони отримали переваги постійної безпеки та вдосконалення функцій MSAL.

- [Запитання й відповіді про ADAL](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- [Дізнайтеся, як перенести програми платформами](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- Якщо вам потрібна допомога з розумінням того, які з ваших програм використовують ADAL, радимо переглянути вихідний код усіх своїх програм і, за необхідності, зв’язатися з будь-якими незалежними постачальниками програмного забезпечення або постачальниками програм. Служба підтримки Microsoft також може надати список усіх сторонніх програм ADAL у вашому клієнті.

**Перенесення AAD Graph**

Для програм, які використовують AAD Graph, дотримуйтеся наших вказівок щодо [перенесення програм Azure AD Graph до Microsoft Graph](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0&preserve-view=true).

- [Контрольний список перенесення для початку роботи](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist). 
- На порталі реєстрації Azure показано, які програми використовують AAD Graph. Радимо переглянути вихідний код усіх своїх програм і, за необхідності, зв’язатися з будь-якими незалежними постачальниками програмного забезпечення або постачальниками програм. Крім того, служба підтримки Microsoft може надати відомості щодо використання AAD Graph у вашому клієнті.

 










